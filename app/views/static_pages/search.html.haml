%script{src: "//cdn.jsdelivr.net/jquery/2.1.3/jquery.min.js"}
%script{src: "//cdn.jsdelivr.net/algoliasearch/3/algoliasearch.min.js"}  

%input{autofocus: "true", autocomplete: "off", class: "autocomplete", id: "q", placeholder: "Start typing...", type: "text", spellcheck: "false"}

#hits
:javascript

  var $inputfield = $('#q');
  var $hits = $('#hits');

  $(document).ready(function() {
    var client = algoliasearch("0949R8OD7S", "b954bfc9213c62c07a0b12019213ec4a");
    var index = client.initIndex('List_#{Rails.env}');

    $inputfield.keyup(function() {
      index.search($inputfield.val(), searchCallback);
    }).focus();
  });

  function searchCallback(err, content) {
    if (err) {
      console.error(err);
      return;
    }

    if (content.query !== $inputfield.val()) {
      // do not take out-dated answers into account
      return;
    }

    if (content.hits.length === 0) {
      // no results
      $hits.empty();
      return;
    }

    // Scan all hits and display them
    var html = '';
    for (var i = 0; i < content.hits.length; ++i) {
      var hit = content.hits[i];

      // For example, display all properties that have at least
      // one highlighted word (matchLevel = full or partial)
      html += '<div class="hit">';
      for (var propertyName in hit._highlightResult) {
        var el = hit._highlightResult[propertyName];
        if (!Array.isArray(el) && el.matchLevel !== 'none') {
          html += '<div class="attribute"><span>' + propertyName.substr(0,1).toUpperCase() +
            propertyName.substr(1) + ": </span>" + el.value + "</div>";
        }
      }
      html += '</div>';
    }

    $hits.html(html);
  }